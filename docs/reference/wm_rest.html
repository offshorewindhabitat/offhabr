<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Query WoRMS REST API with multiple requests — wm_rest • offhabr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Query WoRMS REST API with multiple requests — wm_rest"><meta property="og:description" content="When trying to perform batch requests the WoRMS REST API unfortunately does
not return the requested field so it is not obvious which taxa requested
matches which response. Even when fetching records in batch by aphia_id
functions in the worrms R package do not page requests based on the record
limits of the WoRMS REST API. Finally, it is much preferred to use the
multiplexing capabilities of the latest httr2 library to send multiple
requests in parallel, versus each one sequentially."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">offhabr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ecoquants/offhabr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query WoRMS REST API with multiple requests</h1>
    <small class="dont-index">Source: <a href="https://github.com/ecoquants/offhabr/blob/HEAD/R/worms.R" class="external-link"><code>R/worms.R</code></a></small>
    <div class="hidden name"><code>wm_rest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>When trying to perform batch requests the WoRMS REST API unfortunately does
not return the requested field so it is not obvious which taxa requested
matches which response. Even when fetching records in batch by <code>aphia_id</code>
functions in the <code>worrms</code> R package do not page requests based on the record
limits of the WoRMS REST API. Finally, it is much preferred to use the
multiplexing capabilities of the latest <code>httr2</code> library to send multiple
requests in parallel, versus each one sequentially.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">wm_rest</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">fld</span>,</span>
<span>  operation <span class="op">=</span> <span class="st">"AphiaRecordsByMatchNames"</span>,</span>
<span>  server <span class="op">=</span> <span class="st">"https://www.marinespecies.org/rest"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>data frame to match</p></dd>


<dt>fld</dt>
<dd><p>field in data frame to use with operation</p></dd>


<dt>operation</dt>
<dd><p>operation name of WoRMS REST API; One of operations listed
at <a href="https://www.marinespecies.org/rest" class="external-link">marinespecies.org/rest</a>, like
"AphiaRecordsByMatchNames" (non-paging), "AphiaRecordsByVernacular" (paging),
"AphiaRecordsByNames" (paging), or "AphiaRecordsByAphiaIDs" (paging);
default: "AphiaRecordsByMatchNames"</p></dd>


<dt>server</dt>
<dd><p>URL of server REST endpoint; default: "https://www.marinespecies.org/rest"</p></dd>


<dt>...</dt>
<dd><p>other query parameters to pass to operation</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>data frame of results from WoRMS API prepended with unique values from <code>fld</code></p>


    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">tmp_test</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>           <span class="op">~</span><span class="va">common</span>,                     <span class="op">~</span><span class="va">scientific</span>, <span class="va">aphia_id_0</span>,</span></span>
<span class="r-in"><span>     <span class="st">"Minke whale"</span>,     <span class="st">"Balaenoptera acutorostrata"</span>, <span class="fl">137087</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Blue whale"</span>,          <span class="st">"Balaenoptera musculus"</span>, <span class="fl">137090</span>,</span></span>
<span class="r-in"><span><span class="st">"Bonaparte's Gull"</span>,   <span class="st">"Chroicocephalus philadelphia"</span>, <span class="fl">882954</span><span class="op">)</span> <span class="co"># 882954 invalid non-marine -&gt; valid marine 159076</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">wm_exact</span> <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByMatchNames"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wm_fuzzy</span> <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByNames"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wm_byid</span>  <span class="op">&lt;-</span> <span class="fu">wm_rest</span><span class="op">(</span><span class="va">tmp_test</span>, <span class="va">scientific</span>, <span class="st">"AphiaRecordsByNames"</span>, marine_only<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wm_add_aphia_id.html">wm_add_aphia_id</a></span><span class="op">(</span><span class="va">df_test</span>, <span class="va">scientific</span>, tbl_str <span class="op">=</span> <span class="st">"tmp_test"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ben Best.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

